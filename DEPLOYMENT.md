# Deployment Guide - Render

## Prerequisites

1. **MongoDB Atlas Account**
   - Create a free cluster at https://www.mongodb.com/cloud/atlas
   - Get your connection string (should look like: `mongodb+srv://username:password@cluster.mongodb.net/expense_tracker`)
   - Whitelist all IPs (0.0.0.0/0) for Render to connect

2. **Google OAuth Credentials**
   - Go to https://console.cloud.google.com/
   - Create OAuth 2.0 credentials
   - Add authorized redirect URIs:
     - `https://your-frontend-url.onrender.com`
     - `http://localhost:5173` (for development)

3. **Gemini API Key**
   - Already have: `AIzaSyBcnPIGkKdkSpoJaPv3W3mw3uV7c9pH2QI`

## Deployment Steps

### Option 1: Using render.yaml (Recommended)

1. **Push to GitHub**
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git remote add origin https://github.com/yourusername/expense-tracker.git
   git push -u origin main
   ```

2. **Connect to Render**
   - Go to https://dashboard.render.com/
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file

3. **Set Environment Variables**
   In Render dashboard, set these for the backend service:
   - `MONGO_URI`: Your MongoDB Atlas connection string
   - `GOOGLE_CLIENT_ID`: Your Google OAuth client ID
   - `GOOGLE_CLIENT_SECRET`: Your Google OAuth client secret
   - `GEMINI_API_KEY`: `AIzaSyBcnPIGkKdkSpoJaPv3W3mw3uV7c9pH2QI`
   - `GMAIL_USER`: `bookhive.rsd@gmail.com`
   - `GMAIL_PASSWORD`: `dvjj blxj zyde tukh`
   - `JWT_SECRET_KEY`: Auto-generated by Render

   For the frontend service:
   - `VITE_GOOGLE_CLIENT_ID`: Your Google OAuth client ID
   - `VITE_API_URL`: Will be the backend URL (e.g., `https://expense-tracker-api.onrender.com`)

4. **Update CORS Settings**
   After deployment, update the `ALLOWED_ORIGINS` environment variable in backend with your frontend URL:
   ```
   https://your-frontend-name.onrender.com
   ```

### Option 2: Manual Deployment

#### Backend Deployment

1. **Create Web Service**
   - Go to Render Dashboard
   - New → Web Service
   - Connect GitHub repository
   - Select `backend` directory
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `uvicorn main:app --host 0.0.0.0 --port $PORT`
   - Set all environment variables listed above

#### Frontend Deployment

1. **Create Static Site**
   - New → Static Site
   - Connect GitHub repository
   - Select `frontend` directory
   - Build Command: `npm install && npm run build`
   - Publish Directory: `dist`
   - Add environment variables:
     - `VITE_API_URL`: Backend URL
     - `VITE_GOOGLE_CLIENT_ID`: Google OAuth client ID

2. **Configure Redirects**
   Add to render.yaml or in dashboard:
   ```yaml
   routes:
     - type: rewrite
       source: /*
       destination: /index.html
   ```

## Post-Deployment Configuration

### 1. Update Google OAuth Redirect URIs
Add your Render frontend URL to Google Console:
- `https://your-frontend.onrender.com`
- `https://your-frontend.onrender.com/auth/callback`

### 2. Update Backend CORS
In the backend environment variables, update `ALLOWED_ORIGINS`:
```
https://your-frontend.onrender.com
```

### 3. Test the Application
1. Visit your frontend URL
2. Try logging in with Google
3. Add test expenses
4. Check all features work

## Monitoring

1. **View Logs**
   - Backend logs: Render Dashboard → Your Backend Service → Logs
   - Frontend logs: Render Dashboard → Your Static Site → Logs

2. **Check Health**
   - Backend health: `https://your-backend.onrender.com/health`

## Troubleshooting

### Issue: Google Login Fails
- Check that redirect URIs are correctly configured
- Verify `VITE_GOOGLE_CLIENT_ID` matches backend `GOOGLE_CLIENT_ID`
- Check browser console for errors

### Issue: API Calls Fail
- Verify `VITE_API_URL` points to correct backend URL
- Check CORS settings in backend
- Ensure MongoDB connection string is correct

### Issue: Free Tier Limitations
- Render free tier spins down after inactivity
- First request after spin-down may take 30-60 seconds
- Consider upgrading for production use

## Environment Variables Reference

### Backend (.env)
```env
MONGO_URI=mongodb+srv://...
JWT_SECRET_KEY=auto-generated
JWT_ALGORITHM=HS256
GOOGLE_CLIENT_ID=660588293356-cn4avuvo2mcrsdso2vffvhs0lenkh5t5.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
GEMINI_API_KEY=AIzaSyBcnPIGkKdkSpoJaPv3W3mw3uV7c9pH2QI
GMAIL_USER=bookhive.rsd@gmail.com
GMAIL_PASSWORD=dvjj blxj zyde tukh
ALLOWED_ORIGINS=https://your-frontend.onrender.com
```

### Frontend (.env)
```env
VITE_API_URL=https://your-backend.onrender.com
VITE_GOOGLE_CLIENT_ID=660588293356-cn4avuvo2mcrsdso2vffvhs0lenkh5t5.apps.googleusercontent.com
```

## Cost Considerations

**Free Tier Includes:**
- 750 hours/month per service
- Automatic HTTPS
- Continuous deployment from Git
- Spin down after 15 minutes of inactivity

**Limitations:**
- Services spin down when inactive
- Limited bandwidth
- Shared resources

For production, consider upgrading to paid plans for:
- Always-on services
- Better performance
- More resources
- No spin-down

## Security Best Practices

1. **Never commit .env files**
   - Already in .gitignore
   - Use Render's environment variables

2. **Rotate secrets regularly**
   - JWT keys
   - API keys
   - Database passwords

3. **Use MongoDB IP Whitelist**
   - Add Render's IPs if possible
   - Or use 0.0.0.0/0 (less secure but necessary for free tier)

4. **Monitor API usage**
   - Check Gemini API quota
   - Monitor MongoDB usage

## Maintenance

### Update Dependencies
```bash
# Backend
cd backend
pip install --upgrade -r requirements.txt

# Frontend
cd frontend
npm update
```

### Backup Database
- Use MongoDB Atlas automated backups
- Export data regularly

### Monitor Performance
- Use Render metrics
- Check MongoDB performance metrics
- Monitor API response times
